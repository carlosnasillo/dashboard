machine:
  timezone: 
    UTC
  java:
    version: oraclejdk8
  node:
      version: 5.1.0
  services:
      - mongodb

dependencies:
  cache_directories:
    - ~/.sbt
    - ~/.ivy2
    - ~/.activator
    - ~/.m2
    - bower_components
    - node_modules
  override:
    - "npm install":
        timeout: 300
    - "node_modules/protractor/bin/webdriver-manager update":
        timeout: 300
    - "./activator compile":
        timeout: 300

database:
  override:
    - mongoimport -h localhost:27017 -d lattice -c loanAnalytics --file db/test_backup_loanAnalytics.json
    - mongoimport -h localhost:27017 -d lattice -c loans --file db/test_backup_loans.json
    - mongoimport -h localhost:27017 -d lattice -c loansbook --file db/test_backup_loansbook.json
    - mongoimport -h localhost:27017 -d lattice -c userlogin --file db/test_backup_userlogin.json

test:
  pre:
    # Packages the app
    - "./activator stage":
        timeout: 900
    # Starts the app to run e2e tests
    - "target/universal/stage/bin/dashboard":
        background: true
  override:
    - "./activator test":
        timeout: 900
    - "npm test":
        timeout: 300
  post:
    - "mkdir -p $CIRCLE_TEST_REPORTS/junit/"
    - "cp target/test-reports/*.xml $CIRCLE_TEST_REPORTS/junit/ 2>/dev/null || :"

##notify:
##  webhooks:
##    TODO [carlos] - Slack integration